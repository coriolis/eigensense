(()=>{var e={183:(e,t,s)=>{"use strict";var o=s(33);class r{static async getInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.processor??=o.oye.from_pretrained(this.model_id),this.tokenizer??=o.v6I.from_pretrained(this.model_id),this.supports_fp16??=await async function(){try{return(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch(e){return!1}}(),this.model??=o.syV.from_pretrained(this.model_id,{dtype:{embed_tokens:this.supports_fp16?"fp16":"fp32",vision_encoder:this.supports_fp16?"fp16":"fp32",encoder_model:"q4",decoder_model_merged:"q4"},device:"webgpu",progress_callback:e}),console.log("Model -> ",this.model),Promise.all([this.model,this.tokenizer,this.processor])}}r.model_id="onnx-community/Florence-2-base-ft";const n=["<CAPTION_TO_PHRASE_GROUNDING>"];let a,i;self.addEventListener("message",(async e=>{const{type:t,data:s}=e.data;switch(t){case"load":!async function(){console.log("loading..inside worker"),self.postMessage({status:"progress",data:"Loading model..."});const[e,t,s]=await r.getInstance((e=>{self.postMessage(e)}));console.log("loadded flourecnee model in memory.."),self.postMessage({status:"done",data:"Compiling shaders and warming up model..."});const n=t("a"),a=(0,o.a2Z)([1,3,768,768],0);console.log("modelll -> ",e),await e.generate({...n,pixel_values:a,max_new_tokens:1}),self.postMessage({status:"ready"})}();break;case"run":!async function(e){let{text:t,url:s,task:l,timeStamp:c,isUserSnap:p}=e;const[d,f,u]=await r.getInstance();console.log("In run() About to run flourence....");const m=performance.now();if(!a){const e=await o.YOx.fromURL(s);i=e.size,a=await u(e)}let g=l;n.includes(l)&&t&&(g+=t);const _=f(u.construct_prompts(g)),h=await d.generate({..._,...a,max_new_tokens:350,num_beams:1,do_sample:!1}),v=f.batch_decode(h,{skip_special_tokens:!1})[0],y=u.post_process_generation(v,l,i),b=performance.now();console.log("Flourecne Reponse",y),self.postMessage({status:"complete",result:y,time:b-m,timeStamp:c,isUserSnap:p}),self.postMessage({status:"caption",result:y,time:b-m,timeStamp:c,isUserSnap:p}),a=i=null}(s);break;case"reset":!async function(){console.log("resetting"),a=i=null,self.postMessage({status:"ready"})}()}}))},52:()=>{},143:()=>{},603:()=>{},806:()=>{},9:()=>{},837:()=>{},499:()=>{}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,s),n.exports}s.m=e,s.x=()=>{var e=s.O(void 0,[33],(()=>s(183)));return e=s.O(e)},(()=>{var e=[];s.O=(t,o,r,n)=>{if(!o){var a=1/0;for(p=0;p<e.length;p++){o=e[p][0],r=e[p][1],n=e[p][2];for(var i=!0,l=0;l<o.length;l++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](o[l])))?o.splice(l--,1):(i=!1,n<a&&(a=n));if(i){e.splice(p--,1);var c=r();void 0!==c&&(t=c)}}return t}n=n||0;for(var p=e.length;p>0&&e[p-1][2]>n;p--)e[p]=e[p-1];e[p]=[o,r,n]}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(o,r){if(1&r&&(o=this(o)),8&r)return o;if("object"===typeof o&&o){if(4&r&&o.__esModule)return o;if(16&r&&"function"===typeof o.then)return o}var n=Object.create(null);s.r(n);var a={};e=e||[null,t({}),t([]),t(t)];for(var i=2&r&&o;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>a[e]=()=>o[e]));return a.default=()=>o,s.d(n,a),n}})(),s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,o)=>(s.f[o](e,t),t)),[])),s.u=e=>"static/js/"+e+".1faa5fbf.chunk.js",s.miniCssF=e=>{},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="/",(()=>{s.b=self.location+"/../../../";var e={91:1};s.f.i=(t,o)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunkfrontend=self.webpackChunkfrontend||[],o=t.push.bind(t);t.push=t=>{var r=t[0],n=t[1],a=t[2];for(var i in n)s.o(n,i)&&(s.m[i]=n[i]);for(a&&a(s);r.length;)e[r.pop()]=1;o(t)}})(),(()=>{var e=s.x;s.x=()=>s.e(33).then(e)})();s.x()})();
//# sourceMappingURL=91.d3806037.chunk.js.map